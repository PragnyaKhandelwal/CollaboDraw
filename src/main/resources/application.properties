spring.application.name=collabodraw

############################################
# Database Configuration (Aiven)
#
# Prefer environment variables for secrets:
#   DB_URL (full JDBC URL) OR AIVEN_HOST/AIVEN_PORT/AIVEN_DB via scripts/run-aiven.ps1
#   DB_USER
#   DB_PASS
#
# Example DB_URL:
#   jdbc:mysql://collabodraw-pratishtha-400c.f.aivencloud.com:17118/defaultdb?sslMode=REQUIRED&serverTimezone=Asia/Kolkata
############################################

# JDBC URL (Aiven public endpoint). Constructed from host/port/db env vars.
# Prefer setting DB_HOST/DB_PORT/DB_NAME (or AIVEN_HOST/AIVEN_PORT/AIVEN_DB) in .env
# Note: JDBC expects 'sslMode' (camel-case)
spring.datasource.url=jdbc:mysql://${AIVEN_HOST:${DB_HOST}}:${AIVEN_PORT:${DB_PORT:17118}}/${AIVEN_DB:${DB_NAME:defaultdb}}?sslMode=${SSL_MODE:REQUIRED}&serverTimezone=Asia/Kolkata&connectTimeout=5000&socketTimeout=10000&tcpKeepAlive=true

spring.datasource.username=${DB_USER}
spring.datasource.password=${DB_PASS}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# Connection Pool Configuration
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.connection-timeout=10000
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1200000
spring.datasource.hikari.initialization-fail-timeout=-1
spring.datasource.hikari.validation-timeout=5000
spring.datasource.hikari.connection-test-query=SELECT 1

# (Schema pre-provisioned in Aiven DB; disable local init)
# spring.sql.init.mode=never

# Server port (optional override)
# server.port=8080
# OAuth2 Configuration - Google Login (externalize secrets via env)
spring.security.oauth2.client.registration.google.client-id=${GOOGLE_CLIENT_ID}
spring.security.oauth2.client.registration.google.client-secret=${GOOGLE_CLIENT_SECRET}
spring.security.oauth2.client.registration.google.scope=openid,profile,email
spring.security.oauth2.client.registration.google.redirect-uri={baseUrl}/login/oauth2/code/google

# OAuth2 Provider - Google
spring.security.oauth2.client.provider.google.authorization-uri=https://accounts.google.com/o/oauth2/v2/auth
spring.security.oauth2.client.provider.google.token-uri=https://www.googleapis.com/oauth2/v4/token
spring.security.oauth2.client.provider.google.user-info-uri=https://www.googleapis.com/oauth2/v3/userinfo
spring.security.oauth2.client.provider.google.user-name-attribute=sub
# JPA/Hibernate Configuration
# Set explicit dialect to avoid failure when JDBC metadata is unavailable during startup.
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.jdbc.time_zone=Asia/Kolkata
spring.jpa.open-in-view=false

# Disable H2 console auto-config (we use MySQL via proxy)
spring.h2.console.enabled=false

# Logging Configuration
logging.level.org.springframework.web=INFO
logging.level.org.springframework.boot.autoconfigure.web=INFO

# Static Resources Configuration
spring.web.resources.add-mappings=true

############################################
# Usage Summary
#   Use .env + scripts/run-aiven.ps1 (Windows) to export DB_URL/DB_USER/DB_PASS then run the app.
#   Alternatively set env vars manually and run mvn normally.
############################################